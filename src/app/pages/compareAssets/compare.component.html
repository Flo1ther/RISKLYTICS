<section *ngIf="!loading && assets.length; else empty">
  
  <div class="total">
    <span class="label">Total Portfolio Value</span>
    <span class="value">
      ${{ totalPortfolioUsd | number:'1.0-2' }}
    </span>
  </div>

  <div class="chart">
    <div echarts [options]="allocationChart" class="pie"></div>
  </div>

  <div class="list">
    <div class="row header">
      <span>Asset</span>
      <span>Amount</span>
      <span>Value</span>
      <span>24h</span>
    </div>

    <div class="row" *ngFor="let a of assets">
      <span>{{ a.symbol }}</span>
      <span>{{ a.amount }}</span>
      <span>${{ a.valueUsd | number:'1.0-2' }}</span>
      <span
        [class.pos]="a.change24h >= 0"
        [class.neg]="a.change24h < 0"
      >
        {{ a.change24h | number:'1.2-2' }}%
      </span>
    </div>
  </div>

  <div class="timeframe">
    <button
      *ngFor="let d of [7, 30]"
      (click)="changeTimeframe(d)"
      [class.active]="timeframe === d"
    >
      {{ d }}D
    </button>
  </div>

  <div class="chart">
    <div echarts [options]="performanceChart" class="line"></div>
  </div>

  <div class="whatif">
    <h3>What if simulation</h3>

    <div class="controls">
      <select
        [(ngModel)]="selectedWhatIfAsset"
        [ngModelOptions]="{standalone: true}"
      >
        <option [ngValue]="null">Select asset</option>
        <option
          *ngFor="let a of assets"
          [ngValue]="a"
        >
          {{ a.symbol }}
        </option>
      </select>

      <input
        type="number"
        [(ngModel)]="whatIfAmount"
        [ngModelOptions]="{standalone: true}"
        placeholder="USD amount"
      />

      <input
        type="date"
        [(ngModel)]="whatIfDate"
        [ngModelOptions]="{standalone: true}"
      />

      <button (click)="runWhatIf()">
        Simulate
      </button>
    </div>

    <div *ngIf="whatIfLoading">
      Calculating...
    </div>

    <div *ngIf="whatIfResult" class="result">
      <p>
        Bought:
        <strong>
          {{ whatIfResult.coinsBought | number:'1.4-6' }}
          {{ whatIfResult.symbol }}
        </strong>
      </p>

      <p>
        Current value:
        <strong>
          ${{ whatIfResult.currentValue | number:'1.0-2' }}
        </strong>
      </p>

      <p
        [class.pos]="whatIfResult.pnlPercent >= 0"
        [class.neg]="whatIfResult.pnlPercent < 0"
      >
        PnL:
        {{ whatIfResult.pnlPercent | number:'1.2-2' }}%
      </p>
    </div>

  </div>
</section>

<ng-template #empty>
  <p>Your portfolio is empty</p>
</ng-template>
